<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Formulario WhatsApp Compartible</title>

<style>
body { 
  font-family: Arial, sans-serif;
  background:#f2f2f2;
  padding:20px;
}
h2 { text-align:center; }

form { 
  background:#fff;
  padding:40px;
  border-radius:10px;
  max-width:450px;
  margin:auto;
}
input, textarea, button, select { 
  width:100%;
  padding:10px;
  margin:8px 0;
  border:1px solid #ccc;
  border-radius:5px;
}
button { 
  background:#25d366;
  color:white;
  border:none;
  cursor:pointer;
  font-size:16px;
}
button:hover { background:#1ebc59; }
.error { color:red; font-size:14px; display:none; }

/* Campos del kit digital */
.kitCampos { display:none; margin-top:10px; }
.radioGroup { display:flex; gap:20px; margin-top:5px; }
.kitTitulo { font-weight:bold; text-align:center; margin-bottom:8px; color:#333; }
.kitInputs { display:flex; gap:10px; justify-content:space-between; }
.kitInputs input { text-align:center; border:1px solid #aaa; }
.kitInputs input:nth-child(1),
.kitInputs input:nth-child(2) { width:25%; }
.kitInputs input:nth-child(3) { width:45%; }

/* Grupos de DNI/NIE/NIF */
.dniGroup, .nieGroup, .nifGroup { display:flex; gap:10px; justify-content:left; }
.dniGroup input, .nieGroup input, .nifGroup input { text-align:center; }
.dniGroup input { width:60px; }
.nieGroup input:nth-child(1),
.nieGroup input:nth-child(3),
.nifGroup input:nth-child(1),
.nifGroup input:nth-child(3) { width:50px; }
.nieGroup input:nth-child(2),
.nifGroup input:nth-child(2) { flex:1; }
</style>
</head>
<body>

<h2>Formulario presupuesto</h2>

<form id="whatsappForm">

  <label>Nombre:</label>
  <input type="text" id="nombre" placeholder="Tu nombre">

  <label>Apellidos:</label>
  <input type="text" id="apellidos" placeholder="Tus apellidos">

  <!-- Selecci칩n del tipo de documento -->
  <label>Tipo de documento:</label>
  <select id="tipoDocumento" onchange="mostrarDocumento()">
    <option value="">Selecciona...</option>
    <option value="dni">DNI</option>
    <option value="nie">NIE</option>
    <option value="nif">NIF</option>
  </select>

  <!-- Campo DNI -->
  <div id="campoDNI" class="dniGroup" style="display:none;">
    <input type="text" id="dniNumero" maxlength="8" pattern="\d{8}" placeholder="12345678">
    <input type="text" id="dniLetra" maxlength="1" pattern="[A-Za-z]" placeholder="A">
  </div>

  <!-- Campo NIE -->
  <div id="campoNIE" class="nieGroup" style="display:none;">
    <input type="text" id="nieLetraInicio" maxlength="1" pattern="[A-Za-z]" placeholder="X">
    <input type="text" id="nieNumeros" maxlength="7" pattern="\d{7}" placeholder="1234567">
    <input type="text" id="nieLetraFin" maxlength="1" pattern="[A-Za-z]" placeholder="A">
  </div>

  <!-- Campo NIF -->
  <div id="campoNIF" class="nifGroup" style="display:none;">
    <input type="text" id="nifLetraInicio" maxlength="1" pattern="[A-Za-z]" placeholder="A">
    <input type="text" id="nifNumeros" maxlength="7" pattern="\d{7}" placeholder="1234567">
    <input type="text" id="nifUltimo" maxlength="1" pattern="[A-Za-z0-9]" placeholder="A o 1">
  </div>

  <label>Direcci칩n:</label>
  <input type="text" id="direccion" placeholder="Tu direcci칩n">

  <label>Email:</label>
  <input type="email" id="email" placeholder="tu@email.com">

  <label>Tel칠fono:</label>
  <input type="tel" id="telefono" placeholder="34 600 000 000">

  <label>Concepto (m치x. 150 palabras):</label>
  <textarea id="concepto" maxlength="150" placeholder="Escribe aqu칤 tu mensaje..."></textarea>

  <label>쯂it Digital?</label>
  <div class="radioGroup">
    <label><input type="radio" name="kitDigital" value="si" onclick="mostrarCamposKit(true)"> S칤</label>
    <label><input type="radio" name="kitDigital" value="no" onclick="mostrarCamposKit(false)"> No</label>
  </div>

  <div class="kitCampos" id="camposKit">
    <div class="kitTitulo">N춿 EXPEDIENTE</div>
    <div class="kitInputs">
      <input type="text" id="codigo1" maxlength="4" pattern="\d{4}" placeholder="1234">
      <input type="text" id="codigo2" maxlength="4" pattern="[A-Za-z]{1}\d{3}" placeholder="A123">
      <input type="text" id="codigo3" maxlength="8" pattern="\d{8}" placeholder="12345678">
    </div>
  </div>

  <p class="error" id="errorMsg">丘멆잺 Debe llenar todos los campos antes de enviar.</p>

  <button type="button" onclick="enviarWhatsApp()">Enviar por WhatsApp</button>
  <button type="button" style="background:#007bff;" onclick="compartirFormulario()">Compartir formulario vac칤o</button>
</form>

<script>
function mostrarDocumento() {
  const tipo = document.getElementById("tipoDocumento").value;
  document.getElementById("campoDNI").style.display = tipo === "dni" ? "flex" : "none";
  document.getElementById("campoNIE").style.display = tipo === "nie" ? "flex" : "none";
  document.getElementById("campoNIF").style.display = tipo === "nif" ? "flex" : "none";
}

function mostrarCamposKit(mostrar) {
  const camposKit = document.getElementById("camposKit");
  camposKit.style.display = mostrar ? "block" : "none";
  if (!mostrar) {
    document.getElementById("codigo1").value = "";
    document.getElementById("codigo2").value = "";
    document.getElementById("codigo3").value = "";
  }
}

function generarNumeroCliente() {
  const letra = String.fromCharCode(65 + Math.floor(Math.random() * 26)); // A-Z
  const numero = Math.floor(Math.random() * 900 + 100); // 3 d칤gitos
  return letra + numero;
}

function enviarWhatsApp() {
  const tipo = document.getElementById("tipoDocumento").value;
  const nombre = document.getElementById("nombre").value.trim();
  const apellidos = document.getElementById("apellidos").value.trim();
  const direccion = document.getElementById("direccion").value.trim();
  const email = document.getElementById("email").value.trim();
  const telefono = document.getElementById("telefono").value.trim();
  const concepto = document.getElementById("concepto").value.trim();
  const kitSi = document.querySelector('input[name="kitDigital"][value="si"]').checked;
  const kitNo = document.querySelector('input[name="kitDigital"][value="no"]').checked;
  const errorMsg = document.getElementById("errorMsg");

  if (!nombre || !apellidos || !direccion || !email || !telefono || !concepto || (!kitSi && !kitNo) || !tipo) {
    errorMsg.textContent = "丘멆잺 Debe llenar todos los campos antes de enviar.";
    errorMsg.style.display = "block";
    return;
  }

  let docTexto = "";
  if (tipo === "dni") {
    const num = document.getElementById("dniNumero").value.trim();
    const letra = document.getElementById("dniLetra").value.trim().toUpperCase();
    if (!/^\d{8}$/.test(num) || !/^[A-Za-z]$/.test(letra)) {
      errorMsg.textContent = "丘멆잺 DNI inv치lido (8 n칰meros + 1 letra).";
      errorMsg.style.display = "block";
      return;
    }
    docTexto = `DNI: ${num}${letra}`;
  } else if (tipo === "nie") {
    const l1 = document.getElementById("nieLetraInicio").value.trim().toUpperCase();
    const nums = document.getElementById("nieNumeros").value.trim();
    const l2 = document.getElementById("nieLetraFin").value.trim().toUpperCase();
    if (!/^[A-Za-z]$/.test(l1) || !/^\d{7}$/.test(nums) || !/^[A-Za-z]$/.test(l2)) {
      errorMsg.textContent = "丘멆잺 NIE inv치lido (letra + 7 n칰meros + letra).";
      errorMsg.style.display = "block";
      return;
    }
    docTexto = `NIE: ${l1}${nums}${l2}`;
  } else if (tipo === "nif") {
    const l1 = document.getElementById("nifLetraInicio").value.trim().toUpperCase();
    const nums = document.getElementById("nifNumeros").value.trim();
    const ult = document.getElementById("nifUltimo").value.trim().toUpperCase();
    if (!/^[A-Za-z]$/.test(l1) || !/^\d{7}$/.test(nums) || !/^[A-Za-z0-9]$/.test(ult)) {
      errorMsg.textContent = "丘멆잺 NIF inv치lido (letra + 7 n칰meros + letra o n칰mero).";
      errorMsg.style.display = "block";
      return;
    }
    docTexto = `NIF: ${l1}${nums}${ult}`;
  }

  errorMsg.style.display = "none";
  const numeroDestino = "34633142277";
  const numCliente = generarNumeroCliente();

  let mensaje = `Nuevo formulario de contacto:
游녻 Cliente N췈: ${numCliente}
游녻 Nombre: ${nombre} ${apellidos}
游 ${docTexto}
游 Direcci칩n: ${direccion}
游닎 Email: ${email}
游 Tel칠fono: ${telefono}
游닇 Concepto: ${concepto}
游눹 Kit Digital: ${kitSi ? "S칤" : "No"}`;

  if (kitSi) {
    const c1 = document.getElementById("codigo1").value.trim();
    const c2 = document.getElementById("codigo2").value.trim();
    const c3 = document.getElementById("codigo3").value.trim();
    mensaje += `\n游댝 C칩digo 1: ${c1}\n游 C칩digo 2: ${c2}\n游 C칩digo 3: ${c3}`;
  }

  const url = `https://wa.me/${numeroDestino}?text=${encodeURIComponent(mensaje)}`;
  window.open(url, "_blank");
}

function compartirFormulario() {
  const enlace = window.location.href.split('?')[0];
  const texto = `游닇 Rellena el formulario para solicitar tu presupuesto:\n${enlace}`;
  const url = `https://wa.me/?text=${encodeURIComponent(texto)}`;
  window.open(url, "_blank");
}
</script>
</body>
</html>

